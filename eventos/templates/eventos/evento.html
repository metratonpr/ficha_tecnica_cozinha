{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Ficha Técnica - {{ evento.nome }}</title>

  <style>
    body {
      font-family: "Arial", sans-serif;
      font-size: 13px;
      margin: 2cm;
      color: #333;
    }

    h1, h2 {
      color: #005ca9;
      margin-bottom: 0.3em;
    }

    h1 {
      font-size: 22px;
      border-bottom: 2px solid #005ca9;
      padding-bottom: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0 24px 0;
      font-size: 12px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: left;
    }

    th {
      background: #f2f2f2;
      font-weight: bold;
    }

    .total {
      font-weight: bold;
      background: #e6f3ff;
    }

    .right { text-align: right; }
    .center { text-align: center; }

    .logo {
      width: 140px;
      float: right;
    }

    .header-info {
      margin-bottom: 15px;
    }

    .footer {
      margin-top: 50px;
      font-size: 11px;
      text-align: center;
      color: #777;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
  </style>
</head>

<body>
  <!-- Cabeçalho -->
  <img src="{% static 'img/senac_logo.png' %}" class="logo" alt="SENAC">
  <h1>Ficha Técnica de Evento</h1>

  <div class="header-info">
    <p><strong>Nome do Evento:</strong> {{ evento.nome }}</p>
    <p><strong>Data:</strong> {{ evento.data|date:"d/m/Y" }}</p>
    <p><strong>Nº de Pessoas:</strong> {{ evento.numero_pessoas }}</p>
  </div>

  <!-- Cardápio -->
  <h2>Cardápio</h2>
  <table>
    <thead>
      <tr>
        <th>Receita</th>
        <th class="center">Porções/pessoa</th>
        <th class="right">Custo Total (R$)</th>
      </tr>
    </thead>
    <tbody>
      {% for item in itens %}
      <tr>
        <td>{{ item.receita.titulo }}</td>
        <td class="center">{{ item.porcoes_por_pessoa }}</td>
        <td class="right">{{ item.custo_total }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="3" class="center">Nenhum item de cardápio adicionado.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Equipe -->
  <h2>Equipe</h2>
  <table>
    <thead>
      <tr>
        <th>Função</th>
        <th class="center">Qtd</th>
        <th class="center">Horas</th>
        <th class="right">Valor/hora (R$)</th>
        <th class="right">Custo Total (R$)</th>
      </tr>
    </thead>
    <tbody>
      {% for p in participacoes %}
      <tr>
        <td>{{ p.funcao.nome }}</td>
        <td class="center">{{ p.quantidade }}</td>
        <td class="center">{{ p.horas }}</td>
        <td class="right">{{ p.valor_hora|default:p.funcao.valor_hora_padrao }}</td>
        <td class="right">{{ p.custo_total }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="center">Nenhuma função de equipe adicionada.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Resumo de custos -->
  <h2>Resumo de Custos</h2>
  <table>
    <tbody>
      <tr><td>Custo de Receitas</td><td class="right">{{ evento.custo_receitas }}</td></tr>
      <tr><td>Custo de Mão de Obra</td><td class="right">{{ evento.custo_mao_obra_total }}</td></tr>
      <tr><td>Custo Indireto</td><td class="right">{{ evento.custo_indireto }}</td></tr>
      <tr class="total"><td>Custo Total</td><td class="right">{{ evento.custo_total }}</td></tr>
      <tr><td>Margem de Lucro (%)</td><td class="right">{{ evento.margem_lucro }}</td></tr>
      <tr><td>Preço de Venda Total</td><td class="right">{{ evento.preco_venda_total }}</td></tr>
      <tr><td>Custo por Pessoa</td><td class="right">{{ evento.custo_por_pessoa }}</td></tr>
      <tr><td>Preço por Pessoa</td><td class="right">{{ evento.preco_venda_por_pessoa }}</td></tr>
      <tr class="total"><td>Lucro Estimado</td><td class="right">{{ evento.lucro_estimado }}</td></tr>
    </tbody>
  </table>

  <!-- Lista de Compras -->
  <h2>Lista de Compras</h2>
  <table>
    <thead>
      <tr>
        <th>Ingrediente</th>
        <th class="right">Quantidade Total</th>
        <th class="center">Unidade</th>
        <th class="right">Custo Total (R$)</th>
      </tr>
    </thead>
    <tbody>
      {% for item in lista_compras %}
      <tr>
        <td>{{ item.ingrediente }}</td>
        <td class="right">{{ item.quantidade }}</td>
        <td class="center">{{ item.unidade }}</td>
        <td class="right">{{ item.custo_total }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4" class="center">Nenhum ingrediente calculado.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Rodapé -->
  <div class="footer">
    Sistema de Fichas Técnicas - Padrão SENAC<br>
    Desenvolvido com Django | {{ now|date:"Y" }}
  </div>
</body>
</html>
