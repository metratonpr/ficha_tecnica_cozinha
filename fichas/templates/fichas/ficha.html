{% extends "base.html" %}
{% load static %}
{% block title %}Ficha T√©cnica - {{ receita.titulo }}{% endblock %}

{% block content %}
<div class="container mt-4 ficha-tecnica">

  <!-- Cabe√ßalho -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="text-primary mb-1">{{ receita.titulo }}</h2>
      <p class="text-muted mb-0">Categoria: {{ receita.categoria.nome }}</p>
      {% if receita.disciplina %}
      <p class="text-muted mb-0">Disciplina: {{ receita.disciplina }}</p>
      {% endif %}
      {% if receita.tipo_coccao %}
      <p class="text-muted mb-0">M√©todo de coc√ß√£o: {{ receita.tipo_coccao }}</p>
      {% endif %}
    </div>
    {% if receita.foto_preparo %}
    <img src="{{ receita.foto_preparo.url }}" alt="Foto da receita" class="rounded shadow-sm"
         style="width:180px; height:140px; object-fit:cover;">
    {% endif %}
  </div>

  <!-- Rendimento -->
  <section class="mb-4">
    <h4 class="border-bottom pb-1">üßæ Rendimento</h4>
    <div class="row">
      <div class="col-md-4">
        <p><strong>Total:</strong> {{ receita.rendimento_total }} {{ receita.unidade_rendimento }}</p>
      </div>
      <div class="col-md-4">
        <p><strong>Peso por por√ß√£o:</strong> {{ receita.peso_por_porcao }} {{ receita.unidade_rendimento }}</p>
      </div>
      <div class="col-md-4">
        <p><strong>N¬∫ de por√ß√µes:</strong> {{ numero_porcoes }}</p>
      </div>
    </div>
  </section>

  <!-- Ingredientes -->
  <section class="mb-4">
    <h4 class="border-bottom pb-1">ü•£ Ingredientes</h4>
    <div class="table-responsive">
      <table class="table table-striped table-bordered align-middle">
        <thead class="table-primary">
          <tr>
            <th>Ingrediente</th>
            <th>Unidade</th>
            <th>Qtd L√≠quida</th>
            <th>Medida Caseira</th>
            <th class="text-end">Custo (R$)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in itens %}
          <tr>
            <td>{{ item.ingrediente.nome }}</td>
            <td>{{ item.unidade }}</td>
            <td>{{ item.quantidade_liquida }}</td>
            <td>{{ item.medida_caseira|default:"-" }}</td>
            <td class="text-end">{{ item.custo_total }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center text-muted">Nenhum ingrediente cadastrado.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Sub-receitas -->
  {% if componentes %}
  <section class="mb-4">
    <h4 class="border-bottom pb-1">üç≥ Sub-receitas</h4>
    <div class="table-responsive">
      <table class="table table-bordered table-striped align-middle">
        <thead class="table-secondary">
          <tr>
            <th>Sub-receita</th>
            <th>Quantidade</th>
            <th>Unidade</th>
            <th class="text-end">Custo (R$)</th>
          </tr>
        </thead>
        <tbody>
          {% for comp in componentes %}
          <tr>
            <td>{{ comp.sub_receita.titulo }}</td>
            <td>{{ comp.quantidade }}</td>
            <td>{{ comp.unidade }}</td>
            <td class="text-end">{{ comp.custo_total }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
  {% endif %}

  <!-- Custos -->
  <section class="mb-4">
    <h4 class="border-bottom pb-1">üí∞ Custos</h4>
    <div class="row">
      <div class="col-md-4">
        <p><strong>Custo total:</strong> R$ {{ custo_total }}</p>
      </div>
      <div class="col-md-4">
        <p><strong>Custo por por√ß√£o:</strong> R$ {{ custo_por_porcao }}</p>
      </div>
      <div class="col-md-4">
        <p><strong>Tempo total:</strong> {{ receita.tempo_preparo_min|default:0 }} + {{ receita.tempo_coccao_min|default:0 }} min</p>
      </div>
    </div>
  </section>

  <!-- Modo de preparo -->
  {% if receita.modo_preparo %}
  <section class="mb-4">
    <h4 class="border-bottom pb-1">üìã Modo de preparo</h4>
    <p style="white-space:pre-line;">{{ receita.modo_preparo }}</p>
  </section>
  {% endif %}

  <!-- Observa√ß√µes -->
  {% if receita.observacoes %}
  <section class="mb-4">
    <h4 class="border-bottom pb-1">üìå Observa√ß√µes</h4>
    <p style="white-space:pre-line;">{{ receita.observacoes }}</p>
  </section>
  {% endif %}

  <!-- Bot√µes de a√ß√£o -->
  <div class="d-flex justify-content-between mt-5 mb-4">
    <a href="{% url 'fichas:lista_fichas' %}" class="btn btn-secondary">
      ‚¨Ö Voltar √† lista
    </a>

    <!-- Bot√£o PDF (ser√° implementado depois) -->
    <a href="{% url 'fichas:ficha' receita.pk %}?format=pdf" class="btn btn-danger">
      üñ®Ô∏è Exportar PDF
    </a>
  </div>
</div>

{% endblock %}
