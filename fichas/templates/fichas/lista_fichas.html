{% extends "base.html" %}
{% load static %}

{% block title %}Fichas Técnicas - SENAC{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>📘 Fichas Técnicas de Receitas</h2>

    <!-- 🔍 Filtro de categoria -->
    <form method="get" class="d-flex align-items-center">
      <select name="categoria" class="form-select me-2" style="min-width:220px;">
        <option value="">Todas as categorias</option>
        {% for cat in categorias %}
        <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == categoria_selecionada %}selected{% endif %}>
          {{ cat.nome }}
        </option>
        {% endfor %}
      </select>
      <button class="btn btn-primary" type="submit">Filtrar</button>
    </form>
  </div>

  <hr>

  <div class="row">
    {% for receita in receitas %}
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card shadow-sm border-0 h-100">
        {% if receita.foto_preparo %}
        <img src="{{ receita.foto_preparo.url }}" class="card-img-top"
             alt="Foto da receita {{ receita.titulo }}"
             style="height:200px;object-fit:cover;">
        {% else %}
        <img src="{% static 'img/placeholder_receita.jpg' %}" class="card-img-top"
             alt="Sem imagem" style="height:200px;object-fit:cover;">
        {% endif %}

        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-primary">{{ receita.titulo }}</h5>
          <p class="text-muted mb-1"><strong>Categoria:</strong> {{ receita.categoria.nome }}</p>

          <div class="mt-auto">
            <p class="mb-1">💰 <strong>Custo total:</strong> R$ {{ receita.custo_total }}</p>
            <p class="mb-3">🍽️ <strong>Porção:</strong> R$ {{ receita.custo_por_porcao }}</p>
            <a href="{% url 'fichas:ficha' receita.pk %}" class="btn btn-outline-primary btn-sm w-100">
              📄 Ver Ficha Técnica
            </a>
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="text-center mt-5">
      <h5 class="text-muted">😔 Nenhuma ficha técnica cadastrada.</h5>
    </div>
    {% endfor %}
  </div>

  <!-- 📄 Paginação -->
  {% if is_paginated %}
  <nav aria-label="Paginação" class="mt-4">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link"
           href="?page={{ page_obj.previous_page_number }}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}">
           ← Anterior
        </a>
      </li>
      {% endif %}

      <li class="page-item active">
        <span class="page-link">{{ page_obj.number }}</span>
      </li>

      {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link"
           href="?page={{ page_obj.next_page_number }}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}">
           Próxima →
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>
{% endblock %}
