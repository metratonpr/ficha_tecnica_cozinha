{% extends "base.html" %}
{% load static %}

{% block title %}Fichas TÃ©cnicas - SENAC{% endblock %}

{% block content %}
<div class="space-y-8">

  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold text-slate-900">Fichas TÃ©cnicas de Receitas</h1>
      <p class="mt-1 text-md text-slate-600">Navegue, filtre e encontre as fichas que vocÃª precisa.</p>
    </div>

    <form method="get" class="flex items-center gap-2">
      <select name="categoria" class="block w-full md:w-64 rounded-md border-slate-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 text-sm">
        <option value="">Todas as categorias</option>
        {% for cat in categorias %}
        <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == categoria_selecionada %}selected{% endif %}>
          {{ cat.nome }}
        </option>
        {% endfor %}
      </select>
      <button type="submit" class="inline-flex items-center justify-center rounded-md bg-slate-800 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-800">
        Filtrar
      </button>
    </form>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">

    {% for receita in receitas %}
    <div class="group flex flex-col overflow-hidden rounded-xl bg-white shadow-lg transition-all duration-300 hover:shadow-2xl hover:-translate-y-1">

      <div class="overflow-hidden">
        {% if receita.foto_preparo %}
        <img src="{{ receita.foto_preparo.url }}" alt="Foto da receita {{ receita.titulo }}"
             class="h-52 w-full object-cover transition-transform duration-300 group-hover:scale-105">
        {% else %}
        <img src="{% static 'img/placeholder_receita.jpg' %}" alt="Sem imagem"
             class="h-52 w-full object-cover transition-transform duration-300 group-hover:scale-105">
        {% endif %}
      </div>

      <div class="flex flex-1 flex-col p-5">
        <div class="flex-1">
          <p class="text-sm font-medium text-amber-600">{{ receita.categoria.nome }}</p>
          <h3 class="mt-1 text-lg font-bold text-slate-900">{{ receita.titulo }}</h3>
        </div>

        <div class="mt-6 flex items-center justify-between text-sm">
          <div>
            <p class="text-slate-500">Custo total</p>
            <p class="font-semibold text-slate-800">R$ {{ receita.custo_total }}</p>
          </div>
          <div class="text-right">
            <p class="text-slate-500">Custo/porÃ§Ã£o</p>
            <p class="font-semibold text-slate-800">R$ {{ receita.custo_por_porcao }}</p>
          </div>
        </div>

        <div class="mt-6">
          <a href="{% url 'fichas:ficha' receita.pk %}" class="block w-full rounded-lg bg-slate-100 px-4 py-2.5 text-center text-sm font-semibold text-slate-700 transition-colors hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500">
            ðŸ“„ Ver Ficha TÃ©cnica
          </a>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-span-1 sm:col-span-2 lg:col-span-3 text-center py-16">
        <h5 class="text-xl font-semibold text-slate-700">ðŸ˜” Nenhuma ficha tÃ©cnica encontrada.</h5>
        <p class="mt-2 text-slate-500">Tente ajustar o filtro ou cadastre uma nova receita.</p>
    </div>
    {% endfor %}
  </div>

  {% if is_paginated %}
  <nav aria-label="PaginaÃ§Ã£o" class="flex items-center justify-center pt-8">
    <ul class="flex items-center -space-x-px h-10 text-base">
      {% if page_obj.has_previous %}
      <li>
        <a href="?page={{ page_obj.previous_page_number }}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}" class="flex items-center justify-center px-4 h-10 ml-0 leading-tight text-slate-500 bg-white border border-slate-300 rounded-l-lg hover:bg-slate-100 hover:text-slate-700">
          <span class="sr-only">Anterior</span>
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/></svg>
        </a>
      </li>
      {% endif %}

      <li>
        <span class="flex items-center justify-center px-4 h-10 leading-tight text-slate-700 bg-slate-200 border border-slate-300 z-10" aria-current="page">
          {{ page_obj.number }}
        </span>
      </li>

      {% if page_obj.has_next %}
      <li>
        <a href="?page={{ page_obj.next_page_number }}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}" class="flex items-center justify-center px-4 h-10 leading-tight text-slate-500 bg-white border border-slate-300 rounded-r-lg hover:bg-slate-100 hover:text-slate-700">
          <span class="sr-only">PrÃ³xima</span>
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/></svg>
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

</div>
{% endblock %}